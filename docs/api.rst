Utilizando a API
================

A API é implementada pela pacote Flask-RESTful, onde existem 2 principais endpoints:

+-----------------------------------+----------------------------------------------------------------------------+
| **/api/v1/feiralivre/{registro}** | Manipulação de cada feira, é orientado pelo código de registro das feiras. |
+-----------------------------------+----------------------------------------------------------------------------+
| **/api/v1/feiraslivres/**         | Consulta de varias feiras, podendo ser por filtro.                         |
+-----------------------------------+----------------------------------------------------------------------------+



[POST] Cadastrando de uma nova feira
----------------------------------------

+-------------+-----------------------------------+
| **Método:** | **Endpoint:**                     |
+-------------+-----------------------------------+
| **POST**    | /api/v1/feiralivre/**{registro}** |
+-------------+-----------------------------------+

Exemplo de chamada POST:

.. code-block:: bash

    curl -X POST http://127.0.0.1:8080/api/v1/feiralivre/6005-4 \
        -H "Content-Type: application/json" \
        -d '{
              "nome_feira": "ANGELICA",
              "bairro": "CONSOLACAO",
              "logradouro": "RUA MATO GROSSO C/ PARA",
              "numero": "S/N",
              "referencia": "TV DA RUA SERGIPE",
              "lat": -23550464,
              "long": -46659253,
              "setcens": 355030826000014,
              "areap": 3550308005013,
              "coddist": 26,
              "distrito": "CONSOLACAO",
              "codsubpref": 9,
              "subprefe": "SE",
              "regiao5": "Centro",
              "regiao8": "Centro"
            }'

Exemplo de retornos do POST:

+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Tipo de retorno:**     | **HTTP Status:** | **Conteudo da resposta:**                                                                                                                                                                                                                                                                                                                                                                          |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se foi bem sucedido      |       200        | '{ "id": 42, "registro": "6005-4", "nome_feira": "ANGELICA", "bairro": "CONSOLACAO", "logradouro": "RUA MATO GROSSO C/ PARA", "numero": "S/N", "referencia": "TV DA RUA SERGIPE", "lat": -23550464, "long": -46659253, "setcens": 355030826000014, "areap": 3550308005013, "coddist": 26, "distrito": "CONSOLACAO", "codsubpref": 9, "subprefe": "SE", "regiao5": "Centro", "regiao8": "Centro" }' |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Falha técnica            |       422        | '{ "error": { "message": "Mensagem tecnica do erro" } }'                                                                                                                                                                                                                                                                                                                                           |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se faltar parametros     |       422        | '{ "error": { "message": "Required params is missing for POST", "required": ['nome_feira', 'bairro'] } }'                                                                                                                                                                                                                                                                                          |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


[GET] Obtendo dados de uma feira livre
-------------------------------------------

+-------------+-----------------------------------+
| **Método:** | **Endpoint:**                     |
+-------------+-----------------------------------+
| **GET**     | /api/v1/feiralivre/**{registro}** |
+-------------+-----------------------------------+

Exemplo de chamada GET:

.. code-block:: bash

    curl -X GET http://127.0.0.1:8080/api/v1/feiralivre/6005-4 \
        -H "Content-Type: application/json"

Exemplo de retornos do GET:

+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Tipo de retorno:**     | **HTTP Status:** | **Conteudo da resposta:**                                                                                                                                                                                                                                                                                                                                                                          |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se o objeto existe       |       200        | '{ "id": 42, "registro": "6005-4", "nome_feira": "ANGELICA", "bairro": "CONSOLACAO", "logradouro": "RUA MATO GROSSO C/ PARA", "numero": "S/N", "referencia": "TV DA RUA SERGIPE", "lat": -23550464, "long": -46659253, "setcens": 355030826000014, "areap": 3550308005013, "coddist": 26, "distrito": "CONSOLACAO", "codsubpref": 9, "subprefe": "SE", "regiao5": "Centro", "regiao8": "Centro" }' |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se o objeto NÃO existe   |       204        | ''                                                                                                                                                                                                                                                                                                                                                                                                 |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Falha técnica            |       422        | '{ "error": { "message": "Mensagem tecnica do erro" } }'                                                                                                                                                                                                                                                                                                                                           |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


[PUT] Alterando dos campos cadastrados de uma feira
-------------------------------------------------------

+-------------+-----------------------------------+
| **Método:** | **Endpoint:**                     |
+-------------+-----------------------------------+
| **PUT**     | /api/v1/feiralivre/**{registro}** |
+-------------+-----------------------------------+

Exemplo de chamada PUT:

.. code-block:: bash

  curl -X PUT http://127.0.0.1:8080/api/v1/feiralivre/6005-4 \
      -H "Content-Type: application/json" \
      -d '{
            "nome_feira": "NOVO VALOR",
            "bairro": "NOVO VALOR",
            "logradouro": "NOVO VALOR",
            "numero": "NOVO VALOR",
            "referencia": "NOVO VALOR",
            "lat": 0,
            "long": 0,
            "setcens": 0,
            "areap": 0,
            "coddist": 0,
            "distrito": "NOVO VALOR",
            "codsubpref": 0,
            "subprefe": "NOVO VALOR",
            "regiao5": "NOVO VALOR",
            "regiao8": "NOVO VALOR"
          }'

Exemplo de retornos do PUT:

+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Tipo de retorno:**     | **HTTP Status:** | **Conteudo da resposta:**                                                                                                                                                                                                                                                                                                                                                                          |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se foi bem sucedido      |       200        | '{ "id": 42, "registro": "6005-4", "nome_feira": "NOVO VALOR", "bairro": "NOVO VALOR", "logradouro": "NOVO VALOR", "numero": "NOVO VALOR", "referencia": "NOVO VALOR", "lat": 0, "long": 0, "setcens": 0, "areap": 0, "coddist": 0, "distrito": "NOVO VALOR", "codsubpref": 0, "subprefe": "NOVO VALOR", "regiao5": "NOVO VALOR", "regiao8": "NOVO VALOR"}'                                        |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se o objeto NÃO existe   |       204        | ''                                                                                                                                                                                                                                                                                                                                                                                                 |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Falha técnica            |       422        | '{ "error": { "message": "Mensagem tecnica do erro" } }'                                                                                                                                                                                                                                                                                                                                           |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se faltar parametros     |       422        | '{ "error": { "message": "Required params is missing for POST", "required": ['nome_feira', 'bairro'] } }'                                                                                                                                                                                                                                                                                          |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+



.. note:: Os campos que não podem ser alterados via PUT são: ('registro', 'id')



[DELETE] Excluindo de uma feira através
-------------------------------------------

+-------------+-----------------------------------+
| **Método:** | **Endpoint:**                     |
+-------------+-----------------------------------+
| **DELETE**  | /api/v1/feiralivre/**{registro}** |
+-------------+-----------------------------------+

Exemplo de chamada DELETE:

.. code-block:: bash

    curl -X DELETE http://127.0.0.1:8080/api/v1/feiralivre/6005-4 \
      -H "Content-Type: application/json"


Exemplo de retornos do DELETE:

+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Tipo de retorno:**     | **HTTP Status:** | **Conteudo da resposta:**                                                                                                                                                                                                                                                                                                                                                                          |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se foi bem sucedido      |       200        | '{ "id": 42, "registro": "6005-4", "nome_feira": "NOVO VALOR", "bairro": "NOVO VALOR", "logradouro": "NOVO VALOR", "numero": "NOVO VALOR", "referencia": "NOVO VALOR", "lat": 0, "long": 0, "setcens": 0, "areap": 0, "coddist": 0, "distrito": "NOVO VALOR", "codsubpref": 0, "subprefe": "NOVO VALOR", "regiao5": "NOVO VALOR", "regiao8": "NOVO VALOR"}'                                        |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se o objeto NÃO existe   |       204        | ''                                                                                                                                                                                                                                                                                                                                                                                                 |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Falha técnica            |       422        | '{ "error": { "message": "Mensagem tecnica do erro" } }'                                                                                                                                                                                                                                                                                                                                           |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se faltar parametros     |       422        | '{ "error": { "message": "Required params is missing for POST", "required": ['nome_feira', 'bairro'] } }'                                                                                                                                                                                                                                                                                          |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


[GET] Buscando de diversas feiras
----------------------------------------------------------------

A busca retorna varias feiras em uma só resposta

+-------------+----------------------------------------+
| **Método:** | **Endpoint:**                          |
+-------------+----------------------------------------+
| **GET**     | /api/v1/feiraslivres/?**{parametros}** |
+-------------+----------------------------------------+

A busca pode ser filtada com os seguintes parametros:

+----------------+-----------------------+
| **Parametro:** | **Exemplo de valor:** |
+----------------+-----------------------+
| **distrito**   | CONSOLACAO            |
+----------------+-----------------------+
| **regiao5**    | Centro                |
+----------------+-----------------------+
| **nome_feira** | ANGELICA              |
+----------------+-----------------------+
| **bairro**     | CONSOLACAO            |
+----------------+-----------------------+
| **id**         | 42                    |
+----------------+-----------------------+


Exemplo de busca por todas as feiras:

.. code-block:: bash

  curl -X GET \
    http://127.0.0.1:8080/api/v1/feiraslivres/ \
    -H "Content-Type: application/json"


Exemplo de busca por feiras da região central:

.. code-block:: bash

  curl -X GET \
    http://127.0.0.1:8080/api/v1/feiraslivres/?regiao5=Centro \
    -H "Content-Type: application/json"


Exemplo de busca por feiras do distrito da Consolacao e com nome ANGELICA:

.. code-block:: bash

  curl -X GET \
    http://127.0.0.1:8080/api/v1/feiraslivres/?distrito=CONSOLACAO&nome_feira=ANGELICA \
    -H "Content-Type: application/json"


Exemplo de retornos de GET multiplos:

+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Tipo de retorno:**     | **HTTP Status:** | **Conteudo da resposta:**                                                                                                                                                                                                                                                                                                                                                                          |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se foi bem sucedido      |       200        | '{ "feiras": [ {"id": 42, "registro": "6005-4", "nome_feira": "NOVO VALOR", "bairro": "NOVO VALOR", "logradouro": "NOVO VALOR", "numero": "NOVO VALOR", "referencia": "NOVO VALOR", "lat": 0, "long": 0, "setcens": 0, "areap": 0, "coddist": 0, "distrito": "NOVO VALOR", "codsubpref": 0, "subprefe": "NOVO VALOR", "regiao5": "NOVO VALOR", "regiao8": "NOVO VALOR"} ] }'                       |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se o objeto NÃO existe   |       204        | '{ "feiras": [ ] }'                                                                                                                                                                                                                                                                                                                                                                                |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Falha técnica            |       422        | '{ "error": { "message": "Mensagem tecnica do erro" } }'                                                                                                                                                                                                                                                                                                                                           |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Se faltar parametros     |       422        | '{ "error": { "message": "Required params is missing for POST", "required": ['nome_feira', 'bairro'] } }'                                                                                                                                                                                                                                                                                          |
+--------------------------+------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
